<div class="min-h-screen bg-neutral-50">

    <!-- Sticky header with HERO + filters -->
    <header class="sticky top-0 z-40 border-b bg-white/80 backdrop-blur">
        <div class="mx-auto max-w-6xl px-4 py-3">
            <!-- HERO -->
            <div
                class="relative overflow-hidden rounded-3xl bg-gradient-to-r from-rose-500 to-orange-400 text-white shadow-md">
                <!-- decorative glows -->
                <div class="pointer-events-none absolute -right-16 -top-16 h-56 w-56 rounded-full bg-white/10 blur-2xl">
                </div>
                <div
                    class="pointer-events-none absolute -bottom-16 -left-16 h-56 w-56 rounded-full bg-black/10 blur-2xl">
                </div>

                <div class="p-6 md:p-10">
                    <div class="flex flex-col items-start justify-between gap-6 md:flex-row md:items-center">
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight md:text-4xl">Dishes · Menu</h1>
                            <p class="mt-2 max-w-2xl text-white/90">
                                Fresh, seasonal, and ready to serve
                            </p>
                        </div>
                        <!-- optional chips; remove if you want it cleaner -->
                        <div class="flex flex-wrap gap-2">
                            <span class="rounded-full bg-white/15 px-3 py-1 text-sm">New items daily</span>
                            <span class="rounded-full bg-white/15 px-3 py-1 text-sm">Vegetarian options</span>
                            <span class="rounded-full bg-white/15 px-3 py-1 text-sm">Locally sourced</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="mt-4 grid grid-cols-1 gap-2 md:grid-cols-12">
                <input class="md:col-span-3 rounded-md border border-gray-300 px-3 py-2 text-sm"
                    placeholder="Name contains…" [value]="name()" (input)="name.set($any($event.target).value)" />

                <input class="md:col-span-3 rounded-md border border-gray-300 px-3 py-2 text-sm"
                    placeholder="Description contains…" [value]="description()"
                    (input)="description.set($any($event.target).value)" />

                <input class="md:col-span-2 rounded-md border border-gray-300 px-3 py-2 text-sm"
                    placeholder="Codes e.g. DRINK,DESSERT" [value]="codeCSV()"
                    (input)="codeCSV.set($any($event.target).value)" />

                <input type="date" class="md:col-span-2 rounded-md border border-gray-300 px-3 py-2 text-sm"
                    [value]="createdDateFrom() ?? ''"
                    (input)="createdDateFrom.set($any($event.target).value || undefined)" />

                <input type="date" class="md:col-span-2 rounded-md border border-gray-300 px-3 py-2 text-sm"
                    [value]="createdDateTo() ?? ''"
                    (input)="createdDateTo.set($any($event.target).value || undefined)" />

                <div class="md:col-span-12 flex flex-wrap items-center gap-2">
                    <!-- orderBy -->
                    <select class="rounded-md border border-gray-300 px-2 py-1 text-sm" [value]="orderBy()"
                        (change)="orderBy.set($any($event.target).value)">
                        <option value="createdDate">Created</option>
                        <option value="name">Name</option>
                        <option value="price">Price</option>
                        <option value="stock">Stock</option>
                        <option value="code">Code</option>
                        <option value="id">ID</option>
                    </select>

                    <!-- sort -->
                    <select class="rounded-md border border-gray-300 px-2 py-1 text-sm" [value]="sort()"
                        (change)="sort.set($any($event.target).value)">
                        <option value="ASC">ASC</option>
                        <option value="DESC">DESC</option>
                    </select>

                    <input class="rounded-md border border-gray-300 px-2 py-1 text-sm" placeholder="Price (=)"
                        [value]="price()" (input)="price.set($any($event.target).value)" />

                    <input class="rounded-md border border-gray-300 px-2 py-1 text-sm" placeholder="Stock (=)"
                        [value]="stock()" (input)="stock.set($any($event.target).value)" />

                    <button class="rounded-md bg-rose-600 px-3 py-2 text-sm font-medium text-white hover:bg-rose-700"
                        (click)="applyFilters()">Apply</button>
                    <button
                        class="rounded-md border border-gray-300 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
                        (click)="clearFilters()">Reset</button>
                </div>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl p-4">

        <!-- Error -->
        @if (error()) {
        <div class="mb-4 rounded-xl border border-rose-200 bg-rose-50 p-3 text-rose-700">
            {{ error() }}
        </div>
        }

        <!-- Loading -->
        @if (loading()) {
        <div class="mb-4 flex items-center gap-2 text-gray-600">
            <span class="h-2 w-2 animate-ping rounded-full bg-gray-400"></span>
            Loading…
        </div>
        }

        <!-- Content -->
        @if (!loading()) {

        <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm">

            <!-- Desktop table -->
            <div class="hidden md:block">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <caption class="sr-only">Available dishes</caption>

                        <thead class="bg-gray-50 text-gray-600">
                            <tr>
                                <th class="px-4 py-3 text-left font-medium">
                                    <button class="inline-flex items-center gap-1 hover:underline"
                                        (click)="toggleSort('name')">
                                        Name
                                        <span class="text-xs"
                                            [class.opacity-30]="!isSorted('name','ASC') && !isSorted('name','DESC')">
                                            {{ isSorted('name','ASC') ? '▲' : (isSorted('name','DESC') ? '▼' : '↕') }}
                                        </span>
                                    </button>
                                </th>
                                <th class="px-4 py-3 text-left font-medium">Description</th>
                                <th class="px-4 py-3 text-left font-medium">
                                    <button class="inline-flex items-center gap-1 hover:underline"
                                        (click)="toggleSort('price')">
                                        Price
                                        <span class="text-xs"
                                            [class.opacity-30]="!isSorted('price','ASC') && !isSorted('price','DESC')">
                                            {{ isSorted('price','ASC') ? '▲' : (isSorted('price','DESC') ? '▼' : '↕') }}
                                        </span>
                                    </button>
                                </th>
                                <th class="px-4 py-3 text-left font-medium">
                                    <button class="inline-flex items-center gap-1 hover:underline"
                                        (click)="toggleSort('stock')">
                                        Stock
                                        <span class="text-xs"
                                            [class.opacity-30]="!isSorted('stock','ASC') && !isSorted('stock','DESC')">
                                            {{ isSorted('stock','ASC') ? '▲' : (isSorted('stock','DESC') ? '▼' : '↕') }}
                                        </span>
                                    </button>
                                </th>
                                <th class="px-4 py-3 text-left font-medium">
                                    <button class="inline-flex items-center gap-1 hover:underline" (click)="toggleSort('code.code')">
                                        Code
                                        <span class="text-xs" [class.opacity-30]="!isSorted('code.code','ASC') && !isSorted('code.code','DESC')">
                                            {{ isSorted('code.code','ASC') ? '▲' : (isSorted('code.code','DESC') ? '▼' : '↕') }}
                                        </span>
                                    </button>
                                </th>
                                <th class="px-4 py-3 text-left font-medium">
                                    <button class="inline-flex items-center gap-1 hover:underline"
                                        (click)="toggleSort('createdDate')">
                                        Added
                                        <span class="text-xs"
                                            [class.opacity-30]="!isSorted('createdDate','ASC') && !isSorted('createdDate','DESC')">
                                            {{ isSorted('createdDate','ASC') ? '▲' : (isSorted('createdDate','DESC') ?
                                            '▼' : '↕') }}
                                        </span>
                                    </button>
                                </th>
                            </tr>
                        </thead>

                        <tbody class="divide-y divide-gray-100">
                            @for (r of dishes(); track r.id) {
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="flex items-center gap-3">
                                      <div class="h-12 w-12 overflow-hidden rounded-lg bg-gray-100 ring-1 ring-gray-200">
                                        @if (r.imageUrl) {
                                          <img [src]="r.imageUrl" [alt]="r.name" class="h-full w-full object-cover" loading="lazy" />
                                        } @else {
                                          <div class="h-full w-full bg-gradient-to-br from-gray-200 to-gray-100"></div>
                                        }
                                      </div>
                                      <div class="font-medium text-gray-900">{{ r.name }}</div>
                                    </div>
                                  </td>                                  
                                <td class="px-4 py-3 text-gray-700">{{ r.description }}</td>
                                <td class="px-4 py-3">{{ r.price | currency:'EUR':'symbol' }}</td>
                                <td class="px-4 py-3">
                                    <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium"
                                        [ngClass]="{
                                'bg-emerald-100 text-emerald-700': r.stock > 10,
                                'bg-amber-100 text-amber-700': r.stock > 0 && r.stock <= 10,
                                'bg-rose-100 text-rose-700': r.stock === 0
                              }">
                                        {{ r.stock === 0 ? 'Sold out' : (r.stock <= 10 ? 'Low' : 'In stock' ) }} </span>
                                </td>
                                <td class="px-4 py-3 text-gray-700">{{ r.code.code }}</td>
                                <td class="px-4 py-3 text-gray-600">{{ r.createdDate | date:'yyyy-MM-dd' }}</td>
                            </tr>
                            } @empty {
                            <tr>
                                <td class="px-4 py-10 text-center text-sm text-gray-500" colspan="6">
                                    No dishes found.
                                    <button
                                        class="ml-2 rounded-md border border-gray-300 px-2 py-1 text-gray-700 hover:bg-gray-50"
                                        (click)="fetch()">Retry</button>
                                </td>
                            </tr>
                            }
                        </tbody>

                        <!-- Bottom table line (pagination) -->
                        <tfoot>
                            <tr class="border-t border-gray-200 bg-gray-50">
                                <td class="px-4 py-3 text-sm text-gray-600" colspan="3">
                                    Showing
                                    <span class="font-medium text-gray-900">{{ showingFrom }}</span>–
                                    <span class="font-medium text-gray-900">{{ showingTo }}</span>
                                    of <span class="font-medium text-gray-900">{{ totalElements() }}</span>
                                </td>
                                <td class="px-4 py-3 text-sm" colspan="3">
                                    <div class="flex flex-wrap items-center justify-end gap-1">
                                        <button
                                            class="rounded-md border border-gray-300 px-3 py-1.5 hover:bg-gray-100 disabled:opacity-50"
                                            [disabled]="page() === 0" (click)="prevPage()" aria-label="Previous page">‹
                                            Prev</button>

                                        @for (i of pageNumbers(); track i) {
                                        <button class="rounded-md px-3 py-1.5 text-sm"
                                            [ngClass]="i === page() ? 'bg-gray-900 text-white' : 'border border-gray-300 hover:bg-gray-100'"
                                            (click)="setPage(i)" [attr.aria-current]="i === page() ? 'page' : null">
                                            {{ i + 1 }}
                                        </button>
                                        }

                                        <button
                                            class="rounded-md border border-gray-300 px-3 py-1.5 hover:bg-gray-100 disabled:opacity-50"
                                            [disabled]="page() >= totalPages() - 1" (click)="nextPage()"
                                            aria-label="Next page">Next ›</button>

                                        <!-- Bottom paginator page size -->
                                        <select #pageSizeBottom
                                            class="ml-2 rounded-md border border-gray-300 bg-white px-2 py-1 text-sm"
                                            [value]="size()" (change)="setSize(+pageSizeBottom.value)">
                                            <option [value]="5">5</option>
                                            <option [value]="10">10</option>
                                            <option [value]="20">20</option>
                                            <option [value]="50">50</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Mobile cards -->
            <ul class="grid grid-cols-1 gap-3 p-3 md:hidden">
                @for (r of dishes(); track r.id) {
                    <li class="rounded-xl border border-gray-100 p-4 shadow-sm transition hover:shadow-md">
                        <div class="flex items-start justify-between gap-3">
                          <div class="flex items-start gap-3">
                            <div class="h-16 w-16 overflow-hidden rounded-lg bg-gray-100 ring-1 ring-gray-200">
                              @if (r.imageUrl) {
                                <img [src]="r.imageUrl" [alt]="r.name" class="h-full w-full object-cover" loading="lazy" />
                              } @else {
                                <div class="h-full w-full bg-gradient-to-br from-gray-200 to-gray-100"></div>
                              }
                            </div>
                            <div class="min-w-0">
                              <h3 class="truncate text-base font-semibold text-gray-900">{{ r.name }}</h3>
                              <p class="mt-1 text-sm text-gray-700">{{ r.description }}</p>
                              <div class="mt-2 flex flex-wrap items-center gap-3 text-sm">
                                <span class="font-medium">{{ r.price | currency:'EUR':'symbol' }}</span>
                                <span class="text-gray-600">Code: {{ r.code }}</span>
                                <span class="text-gray-500">{{ r.createdDate | date:'yyyy-MM-dd' }}</span>
                              </div>
                            </div>
                          </div>
                      
                          <span class="shrink-0 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium"
                                [ngClass]="{
                                  'bg-emerald-100 text-emerald-700': r.stock > 10,
                                  'bg-amber-100 text-amber-700': r.stock > 0 && r.stock <= 10,
                                  'bg-rose-100 text-rose-700': r.stock === 0
                                }">
                            {{ r.stock === 0 ? 'Sold out' : (r.stock <= 10 ? 'Low' : 'In stock') }}
                          </span>
                        </div>
                      </li>                      
                } @empty {
                <li class="p-6 text-center text-sm text-gray-500">
                    No dishes found.
                    <button class="ml-2 rounded-md border border-gray-300 px-2 py-1 text-gray-700 hover:bg-gray-50"
                        (click)="fetch()">Retry</button>
                </li>
                }
            </ul>
        </div>
        }
    </main>
</div>